Module.define("vcom/listtools",["vcom/base","jquery","dotimeout","vcom/api"],function(){var n=modules.vcom.api,h=jQuery;this.masteryWidget=function(){var b=h(this),d=b.data();d.parsed||(d.listId=parseInt(d.listId),d.parsed=!0,d.listId?VCOM.auth(function(p){p.validUser?n.remote("/progress/lists/"+d.listId).then(function(c){h("a[data-action\x3dbookmark]").trigger("bookmarkchange",c);if(c&&c.learnable_word_count){var g=function(){a.empty();c.learning&&a.append('\x3cbutton class\x3d"outline" data-action\x3d"stop-learning" title\x3d"Remove from learning program"\x3eStop Learning\x3c/button\x3e');
0==c.progress?a.append('\x3cbutton class\x3d"outline" data-action\x3d"finish-mastery" title\x3d"Add to learning program and start mastering the words on this list."\x3eStart Mastery\x3c/button\x3e'):1>c.progress&&a.append('\x3cbutton class\x3d"outline" data-action\x3d"finish-mastery" title\x3d"Add to learning program and finish mastering the words on this list."\x3eFinish Mastery\x3c/button\x3e')};b.append("\x3ch3\x3eList Mastery\x3c/h3\x3e");b.append('\x3cdiv class\x3d"row"\x3e\x3cdiv class\x3d"label"\x3eYour progress towards mastering all the words in this list.\x3c/div\x3e\x3cdiv class\x3d"actions"\x3e\x3c/div\x3e\x3ccanvas data-action\x3d"finish-mastery" class\x3d"progress"\x3e\x3c/div\x3e');
b.find("canvas").attr("data-progress",Math.floor(100*c.progress));var a=b.find(".actions");g();VCOM.parse(b);b.on("click",'*[data-action\x3d"stop-learning"]',function(){var b=h(this).prop("disabled",!0);h.post("/lists/"+d.listId+"/stop.json",function(){c.learning=!1;g();b.prop("disabled",!1)});return!1});b.on("click",'*[data-action\x3d"finish-mastery"]',function(){document.location.href="/vocabtrainer/"+d.listId;return!1})}}):b.hide()}):b.hide())};jQuery(function(b){function d(){var a=b(".page_wordlist ol.wordlist li.entry.learnable");
if(a.length){var c=function(a){n.remote("/progress/words",{data:{words:a,limit:a.length}}).then(function(a){a&&a.forEach&&a.forEach(function(a){var c=Math.floor(100*a.progress.progress);e[a.word].attr("prog",c).find("i.progress").remove().end().append(b('\x3ci class\x3d"progress"/\x3e').attr({"data-prg":c,title:c+"% Mastered"}))})})},e={};a.map(function(a){a=b(this);e[a.attr("word")]=a});a=Object.keys(e);if(50>=a.length)c(a);else for(var f=0;f<a.length;f+=50)c(a.slice(f,f+50));b(".page_wordlist select#wlOrder").find('option[value\x3d"progress"]').remove().end().append('\x3coption value\x3d"progress"\x3ein progress order\x3c/option\x3e')}else a.find("i.progress").remove(),
b('.page_wordlist select#wlOrder option[value\x3d"progress"]').remove()}function h(a,c,e){function f(c){b.contains(a[0],c.target)||c.target===a[0]||l()}function l(){a.off("hide",l);b("body").off("click",f);a.fadeOut(function(){a.trigger("hidden").remove()})}var k=c.offset();a.css("position","absolute").appendTo("body");var d=a.outerHeight(),q=a.outerWidth();a.hide();var m=c[0].getBoundingClientRect().top+d+30>b(window).height();e=b.extend({alignX:0,alignY:m?0:1,anchorX:0,anchorY:m?1:0,offsetX:0,offsetY:m?
-4:4},e);a.on("hide",l);k.top+=c.height()*e.alignY+-d*e.anchorY+e.offsetY;k.left+=c.width()*e.alignX+-q*e.anchorX+e.offsetX;a.offset(k);b("body").doTimeout("popupclick",1,"on","click",f)}var c=b('meta[name\x3d"vocab:wordlist:id"]').attr("content");VCOM.auth(function(a){a.validUser?(VCOM.recentLists(c),d()):b('.page_wordlist select#wlOrder option[value\x3d"progress"]').remove()});b("body").on("click",'*[data-action\x3d"restart-practice"]',function(a){confirm("Are you sure you would like to restart your Practice session?")&&
(document.location.href="/lists/"+c+"/reset");a.preventDefault();a.stopPropagation();return!1}).on("click",'*[data-action\x3d"restart-bee"]',function(a){confirm("Are you sure you would like to restart your Spelling Bee session?")&&(document.location.href="/lists/"+c+"/bee/reset");a.preventDefault();a.stopPropagation();return!1});var g=b("a[data-action\x3dbookmark]").on("click",function(){var a=b(this);a.hasClass("bookmarked")?(window.ga&&ga("send","event","tools","removefavorite"),b.post("/lists/deletefavorite.json",
{wordlistid:c},function(){a.trigger("bookmarkchange",{starred:!1})})):(window.ga&&ga("send","event","tools","addfavorite"),b.post("/lists/addfavorite.json",{wordlistid:c},function(){a.trigger("bookmarkchange",{starred:!0})}))}).on("bookmarkchange",function(a,c){b(this).toggleClass("bookmarked",!!c.starred);g.data("bookmarkedsrc")&&g.attr("src",c.starred?g.data("bookmarkedsrc"):g.data("unbookmarkedsrc"))}).find("img.icon").each(function(){var a=b(this);a.data("unbookmarkedsrc",a.attr("src"))});b("a[data-action\x3dprint]").on("click",
function(){if(b(".page_wordlist #wordlist").length)window.print();else b('\x3ciframe src\x3d"/lists/'+c+'" style\x3d"display:none" /\x3e').appendTo("body").on("load",function(){var a=b(this);setTimeout(function(){a[0].contentWindow.print()},10);setTimeout(function(){a.remove()},500)})});b("a[data-action\x3dcopy]").on("click",function(){function a(a){d.trigger("hide");VCOM.auth(function(d){b.post("/lists/load.json",{id:c},function(c){var e=c.result.words.map(function(a){var b={word:a.word};a.synsetid&&
(b.synsetid=a.synsetid);a.example&&(b.example=a.example);a.description&&(b.description=a.description);return b});if(d.validUser){var f=b('\x3cform method\x3d"post" /\x3e');b('\x3cinput type\x3d"hidden" name\x3d"wordlist.name" /\x3e').val(c.result.name).appendTo(f);b('\x3cinput type\x3d"hidden" name\x3d"wordlist.description" /\x3e').val(c.result.description).appendTo(f);b('\x3cinput type\x3d"hidden" name\x3d"wordlist.sourceid" /\x3e').val(c.result.wordlistid||"").appendTo(f);b('\x3cinput type\x3d"hidden" name\x3d"addwords" /\x3e').val(JSON.stringify(e)).appendTo(f);
f.attr("action",null==a?"/lists/new":"/lists/"+a.wordlistid+"/edit");f.appendTo(document.body).submit()}else sessionStorage.setItem("listmakerdata",JSON.stringify({action:"edit",shared:!0,words:e,name:c.result.name,sourceid:c.result.wordlistid,description:c.result.description})),document.location.href="/lists/new"})})}$button=b(this);if(!$button.hasClass("showing")){$button.addClass("showing");window.ga&&ga("send","event","tools","copylist");var d=b('\x3cdiv class\x3d"vcom_popup copylist"/\x3e').on("click",
".option",function(){a(b(this).data("wl"))}).on("hidden",function(){$button.removeClass("showing")}).hide();b('\x3ca class\x3d"option" role\x3d"button"\x3eNew List...\x3c/a\x3e').attr("title","Copy to a new vocabulary list").appendTo(d);h(d,$button);VCOM.auth(function(a){a.validUser?b.post("/lists/byprofile.json",{display:"created",orderby:"activitydate",pageSize:11},function(a){if(a.result){var e=0;a.result.wordlists.forEach(function(a){10>++e&&a.wordlistid!=c&&b('\x3ca role\x3d"button" class\x3d"option" /\x3e').text(a.name+
" ("+a.wordcount+")").attr("title",'Add these words to "'+a.name+'"').data("wl",a).appendTo(d)});d.appendTo(document.body).fadeIn()}}):d.appendTo(document.body).fadeIn()});return!1}}).css("user-select","none")})});