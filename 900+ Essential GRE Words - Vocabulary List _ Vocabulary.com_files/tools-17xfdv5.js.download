Module.define("vcom/tools",["jquery","vcom/base","dotimeout"],function(u){function p(b,c,e){function a(a){d.contains(b[0],a.target)||a.target===b[0]||l()}function l(){b.off("hide",l);d("body").off("click",a);b.fadeOut(function(){b.trigger("hidden").remove()})}var h=c.offset();b.css("position","absolute").appendTo("body").on("hide",l);var q=b.outerHeight(),f=b.outerWidth(),g=c[0].getBoundingClientRect().top+q+30>d(window).height();e=d.extend({alignX:0,alignY:g?0:1,anchorX:0,anchorY:g?1:0,offsetX:0,
offsetY:g?-4:4},e);h.top+=c.height()*e.alignY+-q*e.anchorY+e.offsetY;h.left+=c.width()*e.alignX+-f*e.anchorX+e.offsetX;b.show().offset(h);c=b[0].getBoundingClientRect();c.right+20>d(window).width()&&(h.left-=c.right+20-d(window).width(),b.offset(h));b.hide();d("body").doTimeout("popupclick",1,"on","click",a)}function r(b,c){var e=b.closest(".wordPage");if(e.length){var a=d.extend({},e.data());a.lang=a.lang||"en";a.description=e.find(".blurb p.short").text().trim();0==a.description.length&&(b=d("\x3cdiv/\x3e").html(e.find("h3.definition").first().html()),
b.find("a").remove(),a.description=b.text().trim());b=("en"==a.lang?"":a.lang+"/")+escape(a.word).replace(/ /g,"+");a.url="https://vocabulary.com/dictionary/"+b;a.title=a.word+" - Definition from Vocabulary.com";a.shortUrl="https://vocab.com/d/"+b;a.tweet=escape(a.word+" - "+a.shortUrl);a.mailBody=a.word+" : "+a.shortUrl+"\n\n"+a.description+"\n\nFinally, a dictionary with a soul: https://vocab.com/d/"}else a={},a.url=c.url||f(d('link[rel\x3d"canonical"]').attr("href"))||f(a.url=d('meta[property\x3d"og:url"]').attr("content"))||
document.location.href,a.shortUrl=c.shortUrl||f(d('link[rel\x3d"shorturl"]').attr("href"))||0==a.url.indexOf("https://www.vocabulary.com/")?"https://vocab.com/"+a.url.substring(27):a.url,a.title=c.title||f(d('meta[property\x3d"og:title"]').attr("content"))||f(d("head \x3e title").text()),a.description=c.description||f(d('meta[property\x3d"og:description"]').attr("content"))||f(d('meta[name\x3d"description"]').attr("content")),a.tweet=encodeURIComponent(c.tweet||f(d('meta[property\x3d"share:tweet"]').attr("content"))||
a.title+" - "+a.shortUrl),a.mailBody=c.mailBody||f(d('meta[property\x3d"share:mailbody"]').attr("content"))||"Here's a "+b.attr("itemtype")+" I saw on Vocabulary.com:\n\n"+a.title+"\n\n"+a.description+"\n\nRead more at: \n"+a.url;return a}function t(b,c){switch(b){case "facebook":window.open("https://www.facebook.com/sharer/sharer.php?u\x3d"+escape(c.url)+"\x26name\x3d"+escape(c.title)+"\x26description\x3d"+escape(c.description),"share","menubar\x3dno,toolbar\x3dno,resizable\x3dyes,scrollbars\x3dyes,height\x3d360,width\x3d700").focus();
break;case "twitter":window.open("https://twitter.com/home?status\x3d"+c.tweet,"share","menubar\x3dno,toolbar\x3dno,resizable\x3dyes,scrollbars\x3dyes,height\x3d360,width\x3d700").focus();break;case "reddit":window.open("http://www.reddit.com/submit?url\x3d"+escape(c.url),"share","menubar\x3dno,toolbar\x3dno,resizable\x3dyes,scrollbars\x3dyes,height\x3d610,width\x3d860").focus();break;case "tumblr":window.open("http://www.tumblr.com/share/link?url\x3d"+escape(c.url)+"\x26name\x3d"+escape(c.title)+
"\x26description\x3d"+escape(c.description),"share","menubar\x3dno,toolbar\x3dno,resizable\x3dyes,scrollbars\x3dyes,height\x3d450,width\x3d550").focus();break;case "linkedin":window.open("https://www.linkedin.com/shareArticle?mini\x3dtrue\x26url\x3d"+escape(c.url)+"\x26title\x3d"+escape(c.title)+"\x26summary\x3d"+escape(c.description),"share","menubar\x3dno,toolbar\x3dno,resizable\x3dyes,scrollbars\x3dyes,height\x3d450,width\x3d550").focus();break;case "mail":window.open("mailto:?subject\x3d"+encodeURIComponent(c.title)+
"\x26body\x3d"+encodeURIComponent(c.mailBody),"share","menubar\x3dno,toolbar\x3dno,resizable\x3dyes,scrollbars\x3dyes,height\x3d450,width\x3d600").focus()}window.ga&&ga("send","event","tools","share",b)}function f(b){b&&b.length&&(b=b.trim());return b&&b.length?b:null}var d=jQuery,n=window.loginData||{};VCOM.auth(function(b){n=b});this.share=function(){function b(){a.addClass("showing");var b=d('\x3cdiv class\x3d"vcom_popup share"\x3e\x3ca data-action\x3d"facebook" class\x3d"ss-facebook"\x3eFacebook\x3c/a\x3e\x3ca data-action\x3d"twitter" class\x3d"ss-twitter"\x3eTwitter\x3c/a\x3e\x3ca data-action\x3d"linkedin" class\x3d"ss-linkedin"\x3eLinkedIn\x3c/a\x3e\x3ca data-action\x3d"reddit" class\x3d"ss-reddit"\x3eReddit\x3c/a\x3e\x3ca data-action\x3d"tumblr"  class\x3d"ss-tumblr"\x3eTumblr\x3c/a\x3e\x3ca data-action\x3d"mail" class\x3d"ss-mail"\x3eEmail\x3c/a\x3e\x3c/div\x3e').on("hidden",
function(){a.removeClass("showing")});b.find("a").attr("href","javascript:void(0)").addClass("ss-social-circle").on("click",function(){var b=d(this).data("action"),e=a.data("report"),f={},g=void 0;e?(e.proficiency_score=a.data("ability"),d.post("/vocabtrainer/report/share",{reportData:JSON.stringify(e)},function(a){var d={};d.url="https://www.vocabulary.com/vocabtrainer/report/shared/"+a;d.shortUrl="https://vocab.com/"+d.url.substring(27);d.title="My Vocabulary.com Report";d.description="Check out my personalized vocabulary report from Vocabulary.com. With a score of "+
e.proficiency_score+" Iâ€™m in the top "+Math.max(100-Math.round(e.percentile_rank),1)+"% of all learners!";d.tweet=d.description+" "+d.shortUrl;d.mailBody=d.description+" "+d.shortUrl;f=d;g=r(c,f);t(b,g)})):(g=r(c,f),t(b,g))});p(b,a);b.fadeIn()}var c=d(this).empty().addClass("vcom_share"),e=d(this).attr("hideIcon"),a=d('\x3ca title\x3d"Share this" href\x3d"javascript:void(0)"\x3e'+(e?"":'\x3ci class\x3d"ss-link icon"\x3e\x3c/i\x3e')+" \x3cspan\x3eShare It\x3c/span\x3e\x3c/a\x3e").addClass(c.data("buttonclass")||
"button share").on("click",function(){a.hasClass("showing")||b()}).appendTo(c);c.attr("itemtype")&&a.attr("title","Share this "+c.attr("itemtype"));c.attr("label")&&a.find("span").text(c.attr("label"));c.data("report")&&a.data("report",c.data("report"));c.data("ability")&&a.data("ability",c.data("ability"))};this.addToList=function(){var b=d(this).empty().addClass("vcom_addtolist").css("user-select","none"),c=b.attr("label")||"Add to List...",e=b.data("buttonclass")||"button addtolist",a=d('\x3ca title\x3d"Add to Vocabulary List"\x3e\x3ci class\x3d"ss-list icon"\x3e\x3c/i\x3e\x3cspan\x3e'+
c+"\x3c/span\x3e\x3c/a\x3e").addClass(e).on("click",function(){function c(){k.trigger("hide")}function e(a){a?d.post("/lists/save.json",{addwords:JSON.stringify([g]),id:a.wordlistid},function(){d('\x3cdiv class\x3d"confirm"\x3eAdded \x3cstrong\x3e\x3c/strong\x3e to list \x3ca\x3e\x3c/a\x3e\x3c/div\x3e').append(d("\x3cimg/\x3e").attr("src","/images/icons/close.gif").on("click",c)).find("strong").text(g.word).end().find("a").attr("href","/lists/"+a.wordlistid).text(a.name).end().appendTo(k.empty())}):
(c(),d('\x3cform method\x3d"post"\x3e\x3cinput type\x3d"hidden" name\x3d"addwords"/\x3e\x3c/form\x3e').find("input").val(JSON.stringify([g])).end().attr("action",null==a?"/lists/new":"/lists/"+a.wordlistid+"/edit").appendTo(document.body).submit())}var f=b.attr("word")||b.data("word"),m=b.attr("lang")||b.data("lang");m||(m="en");var g={word:f,lang:m};if(n.validUser){if(window.ga&&ga("send","event","tools","addtolist","validuser"),!a.hasClass("showing")){a.addClass("showing");var k=d('\x3cdiv class\x3d"vcom_popup addlist"/\x3e').on("click",
".option",function(){e(d(this).data("wl"))}).on("hidden",function(){a.removeClass("showing")}).hide();d('\x3ca class\x3d"option" role\x3d"button"\x3eNew List...\x3c/a\x3e').attr("title",'Add "'+g.word+'" to a new vocabulary list').appendTo(k);d.post("/lists/byprofile.json",{uid:n.uid,orderby:"activitydate",pageSize:500},function(b){if(b.result){var c=0;b.result.wordlists.forEach(function(a){a.owner&&10>++c&&d('\x3ca role\x3d"button" class\x3d"option" /\x3e').text(a.name+" ("+a.wordcount+")").attr("title",
'Add "'+g.word+'" to "'+a.name+'"').data("wl",a).appendTo(k)});p(k,a);k.appendTo(document.body).fadeIn()}})}}else window.ga&&ga("send","event","tools","addtolist","login"),confirm("You must be logged in to create lists. Would you like to log in now?")&&VCOM.login()}).appendTo(b)}});